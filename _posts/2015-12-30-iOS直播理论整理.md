---
layout: post
title: iOS直播理论整理
date: 2015-12-30 15:32:24.000000000 +09:00
tags: [LiveVideo , Video , Auido , TransferProtocol]
---

根据自己搭建直播app架构和前人文章整理而来。

## 一、常见功能
直播APP的常用业务功能如下：

####1、直播列表
关注、热门、最新、分类直播用户列表等；
####2、观看直播
聊天信息、滚屏弹幕、礼物显示、加载界面等；
####3、自己直播
录制、推流、解码、播放、美颜、心跳、后台切换、主播对管理员操作、管理员对用户等；
####4、聊天
私聊、聊天室、点亮、推送、黑名单等；
####5、礼物
普通礼物、豪华礼物、红包、排行榜、第三方充值、内购、礼物动态更新、提现等；
####6、房间逻辑
创建房间、进入房间、退出房间、55关闭房间、切换房间、房间管理员设置、房间用户列表等；
####7、用户逻辑
普通登陆、第三方登陆、注册、搜索、修改个人信息、关注列表、粉丝列表、忘记密码、查看个人信息、收入榜、关注和取关、检索等；
####8、统计
APP业务统计、第三方统计等；
####9、超管
禁播、隐藏、审核等；

## 二、直播架构
####1.完整直播app实现流程
1.采集、2.滤镜处理、3.编码、4.推流、5.CDN分发、6.拉流、7.解码、8.播放、9.聊天互动
![直播app实现流程](https://raw.githubusercontent.com/GarfieldLover/GarfieldLover.github.io/master/assets/postImages/304825-5481594e6e2a9d56.png)
####2.完整直播app架构
![完整直播app架构](https://raw.githubusercontent.com/GarfieldLover/GarfieldLover.github.io/master/assets/postImages/304825-54974199408c0cc1.png)
####3.完整直播app技术点
![完整直播app技术点](https://raw.githubusercontent.com/GarfieldLover/GarfieldLover.github.io/master/assets/postImages/304825-9b64e9596f3ccdce.jpeg)

## 三、音视频基础知识
####1.音视频基本概念
- 帧:每帧代表一幅静止的图像
- 帧率：每秒显示的图片数。影响画面流畅度，与画面流畅度成正比：帧率越大，画面越流畅；帧率越小，画面越有跳动感。
由于人类眼睛的特殊生理结构，如果所看画面之帧率高于16的时候，就会认为是连贯的，此现象称之为视觉暂留。并且当帧速达到一定数值后，再增长的话，人眼也不容易察觉到有明显的流畅度提升了。
- GOP:（Group of Pictures）画面组，一个GOP就是一组连续的画面，每个画面都是一帧，一个GOP就是很多帧的集合
直播的数据，其实是一组图片，包括I帧、P帧、B帧，当用户第一次观看的时候，会寻找I帧，而播放器会到服务器寻找到最近的I帧反馈给用户。因此，GOP Cache增加了端到端延迟，因为它必须要拿到最近的I帧
GOP Cache的长度越长，画面质量越好
- 码率：图片进行压缩后每秒显示的数据量。
- 分辨率：(矩形)图片的长度和宽度，即图片的尺寸
- 压缩前的每秒数据量:帧率X分辨率(单位应该是若干个字节)
- 压缩比:压缩前的每秒数据量/码率 （对于同一个视频源并采用同一种视频编码算法，则：压缩比越高，画面质量越差。）　
- 视频文件格式：文件的后缀，比如.wmv,.mov,.mp4,.mp3,.avi,主要用处，根据文件格式，系统会自动判断用什么软件打开,
注意: 随意修改文件格式，对文件的本身不会造成太大的影响，比如把avi改成mp4,文件还是avi.
- 视频封装格式：一种储存视频信息的容器，流式封装可以有TS、FLV等，索引式的封装有MP4,MOV,AVI等，主要作用：一个视频文件往往会包含图像和音频，还有一些配置信息(如图像和音频的关联，如何解码它们等)：这些内容需要按照一定的规则组织、封装起来.
注意：会发现封装格式跟文件格式一样，因为一般视频文件格式的后缀名即采用相应的视频封装格式的名称,所以视频文件格式就是视频封装格式。
- 流媒体开发:网络层(socket或st)负责传输，协议层(rtmp或hls)负责网络打包，封装层(flv、ts)负责编解码数据的封装，编码层(h.264和aac)负责图像，音频压缩。

####2.音视频编码解码
