---
layout: post
title: RxSwift
date: 2017-10-26 15:32:24.000000000 +09:00
tags: [Swift]
---

1.å‡½æ•°å¼ç¼–ç¨‹æ˜¯ç§ç¼–ç¨‹èŒƒå¼ï¼Œä»–æ˜¯é€šè¿‡æ„å»ºå‡½æ•°æ“ä½œåºåˆ—,ç„¶åå¯¹è¿™äº›åºåˆ—åšå‡ºå“åº”çš„ç¼–ç¨‹æ–¹å¼ï¼Œå®ƒç»“åˆäº†å‡½æ•°å¼ç¼–ç¨‹ä»¥åŠå“åº”å¼ç¼–ç¨‹
2.å‡½æ•°å¼ç¼–ç¨‹çš„ä¼˜ç‚¹

çµæ´»
é«˜å¤ç”¨
ç®€æ´
æ˜“ç»´æŠ¤
é€‚åº”å„ç§éœ€æ±‚å˜åŒ–

3.æˆ‘ä»¬é€šè¿‡ä¸åŒçš„æ„å»ºå‡½æ•°ï¼Œæ¥åˆ›å»ºæ‰€éœ€è¦çš„æ•°æ®åºåˆ—ã€‚æœ€åé€šè¿‡é€‚å½“çš„æ–¹å¼æ¥å“åº”è¿™ä¸ªåºåˆ—ã€‚è¿™å°±æ˜¯å‡½æ•°å“åº”å¼ç¼–ç¨‹ã€‚
4.Observable<Element>æ˜¯å¯ç›‘å¬åºåˆ—ï¼ŒObserve<Element>æ˜¯è§‚å¯Ÿè€…ï¼Œæ•°æ®ç»‘å®šï¼ˆè®¢é˜…,å°±æ˜¯å°†å¯ç›‘å¬åºåˆ—ç»‘å®šåˆ°è§‚å¯Ÿè€…ä¸Šã€‚
5.RxSwiftæ ¸å¿ƒå†…å®¹

Observable - äº§ç”Ÿäº‹ä»¶
Observer - å“åº”äº‹ä»¶
Operator - åˆ›å»ºå˜åŒ–ç»„åˆäº‹ä»¶
Disposable - ç®¡ç†ç»‘å®šï¼ˆè®¢é˜…ï¼‰çš„ç”Ÿå‘½å‘¨æœŸ
Schedulers - çº¿ç¨‹é˜Ÿåˆ—è°ƒé…


6.Observable - å¯ç›‘å¬åºåˆ—ï¼ˆä¸‡ç‰©çš†åºåˆ—ï¼‰

Single å‘å‡ºä¸€ä¸ªå…ƒç´ ï¼Œæˆ–è€…ä¸€ä¸ª error äº‹ä»¶ï¼Œä¸ä¼šå…±äº«é™„åŠ ä½œç”¨
Completable å‘å‡ºé›¶ä¸ªå…ƒç´ ï¼Œå‘å‡ºä¸€ä¸ª completed äº‹ä»¶æˆ–è€…ä¸€ä¸ª error äº‹ä»¶,ä¸ä¼šå…±äº«é™„åŠ ä½œç”¨
Maybe å‘å‡ºä¸€ä¸ªå…ƒç´ æˆ–è€…ä¸€ä¸ª completed äº‹ä»¶æˆ–è€…ä¸€ä¸ª error äº‹ä»¶,ä¸ä¼šå…±äº«é™„åŠ ä½œç”¨
Driver ä¸ä¼šäº§ç”Ÿ error äº‹ä»¶ï¼Œä¸€å®šåœ¨ MainScheduler ç›‘å¬ï¼ˆä¸»çº¿ç¨‹ç›‘å¬ï¼‰,å…±äº«é™„åŠ ä½œç”¨
Signal Signal å’Œ Driver ç›¸ä¼¼ï¼Œå”¯ä¸€çš„åŒºåˆ«æ˜¯ï¼ŒDriver ä¼šå¯¹æ–°è§‚å¯Ÿè€…å›æ”¾ï¼ˆé‡æ–°å‘é€ï¼‰ä¸Šä¸€ä¸ªå…ƒç´ ï¼Œè€Œ Signal ä¸ä¼šå¯¹æ–°è§‚å¯Ÿè€…å›æ”¾ä¸Šä¸€ä¸ªå…ƒç´ ã€‚
ControlEvent ä¸ä¼šäº§ç”Ÿ error äº‹ä»¶ï¼Œä¸€å®šåœ¨ MainScheduler è®¢é˜…ï¼ˆä¸»çº¿ç¨‹è®¢é˜…ï¼‰,ä¸€å®šåœ¨ MainScheduler ç›‘å¬ï¼ˆä¸»çº¿ç¨‹ç›‘å¬ï¼‰

7ï¼ŒObserver - è§‚å¯Ÿè€…æ˜¯ç”¨æ¥ç›‘å¬äº‹ä»¶ï¼Œç„¶åå®ƒéœ€è¦è¿™ä¸ªäº‹ä»¶åšå‡ºå“åº”,å“åº”äº‹ä»¶çš„éƒ½æ˜¯è§‚å¯Ÿè€…

åˆ›å»ºè§‚å¯Ÿè€…æœ€ç›´æ¥çš„æ–¹æ³•å°±æ˜¯åœ¨ Observable çš„ subscribe æ–¹æ³•åé¢æè¿°ï¼Œäº‹ä»¶å‘ç”Ÿæ—¶ï¼Œéœ€è¦å¦‚ä½•åšå‡ºå“åº”ã€‚è€Œè§‚å¯Ÿè€…å°±æ˜¯ç”±åé¢çš„ onNextï¼ŒonErrorï¼ŒonCompletedçš„è¿™äº›é—­åŒ…æ„å»ºå‡ºæ¥çš„ã€‚
Binder ä¸ä¼šå¤„ç†é”™è¯¯äº‹ä»¶ï¼Œç¡®ä¿ç»‘å®šéƒ½æ˜¯åœ¨ç»™å®š Scheduler ä¸Šæ‰§è¡Œï¼ˆé»˜è®¤ MainSchedulerï¼‰
button.rx.isEnabled

extension Reactive where Base: UIControl {
  public var isEnabled: Binder<Bool> {
      return Binder(self.base) { control, value in
          control.isEnabled = value
      }
  }
}
å¤åˆ¶ä»£ç 

label.rx.text

extension Reactive where Base: UILabel {
  public var text: Binder<String?> {
      return Binder(self.base) { label, text in
          label.text = text
      }
  }
}
å¤åˆ¶ä»£ç 
8.Observable & Observer æ—¢æ˜¯å¯ç›‘å¬åºåˆ—ä¹Ÿæ˜¯è§‚å¯Ÿè€…,ä¾‹å¦‚ï¼štextFieldçš„å½“å‰æ–‡æœ¬ã€‚å®ƒå¯ä»¥çœ‹æˆæ˜¯ç”±ç”¨æˆ·è¾“å…¥ï¼Œè€Œäº§ç”Ÿçš„ä¸€ä¸ªæ–‡æœ¬åºåˆ—ã€‚ä¹Ÿå¯ä»¥æ˜¯ç”±å¤–éƒ¨æ–‡æœ¬åºåˆ—ï¼Œæ¥æ§åˆ¶å½“å‰æ˜¾ç¤ºå†…å®¹çš„è§‚å¯Ÿè€…ï¼š
// ä½œä¸ºå¯ç›‘å¬åºåˆ—
let observable = textField.rx.text
observable.subscribe(onNext: { text in show(text: text) })
å¤åˆ¶ä»£ç 
// ä½œä¸ºè§‚å¯Ÿè€…
let observer = textField.rx.text
let text: Observable<String?> = ...
text.bind(to: observer)
å¤åˆ¶ä»£ç 
æœ‰è®¸å¤š UI æ§ä»¶éƒ½å­˜åœ¨è¿™ç§ç‰¹æ€§ï¼Œä¾‹å¦‚ï¼šswitchçš„å¼€å…³çŠ¶æ€ï¼ŒsegmentedControlçš„é€‰ä¸­ç´¢å¼•å·ï¼ŒdatePickerçš„é€‰ä¸­æ—¥æœŸç­‰ç­‰ã€‚

AsyncSubject å°†åœ¨æº Observable äº§ç”Ÿå®Œæˆäº‹ä»¶åï¼Œå‘å‡ºæœ€åä¸€ä¸ªå…ƒç´ ï¼ˆä»…ä»…åªæœ‰æœ€åä¸€ä¸ªå…ƒç´ ï¼‰ï¼Œå¦‚æœæº Observable æ²¡æœ‰å‘å‡ºä»»ä½•å…ƒç´ ï¼Œåªæœ‰ä¸€ä¸ªå®Œæˆäº‹ä»¶ã€‚é‚£ AsyncSubject ä¹Ÿåªæœ‰ä¸€ä¸ªå®Œæˆäº‹ä»¶ã€‚

let disposeBag = DisposeBag()
let subject = AsyncSubject<String>()

subject
  .subscribe { print("Subscription: 1 Event:", $0) }
  .disposed(by: disposeBag)

subject.onNext("ğŸ¶")
subject.onNext("ğŸ±")
subject.onNext("ğŸ¹")
subject.onCompleted()
å¤åˆ¶ä»£ç 
ç»“æœ
Subscription: 1 Event: next(ğŸ¹)
Subscription: 1 Event: completed
å¤åˆ¶ä»£ç 

PublishSubject å°†å¯¹è§‚å¯Ÿè€…å‘é€è®¢é˜…åäº§ç”Ÿçš„å…ƒç´ ï¼Œè€Œåœ¨è®¢é˜…å‰å‘å‡ºçš„å…ƒç´ å°†ä¸ä¼šå‘é€ç»™è§‚å¯Ÿè€…ã€‚å¦‚æœä½ å¸Œæœ›è§‚å¯Ÿè€…æ¥æ”¶åˆ°æ‰€æœ‰çš„å…ƒç´ ï¼Œä½ å¯ä»¥é€šè¿‡ä½¿ç”¨ Observable çš„ create æ–¹æ³•æ¥åˆ›å»º Observableï¼Œæˆ–è€…ä½¿ç”¨ ReplaySubjectã€‚

let disposeBag = DisposeBag()
let subject = PublishSubject<String>()

subject
  .subscribe { print("Subscription: 1 Event:", $0) }
  .disposed(by: disposeBag)

subject.onNext("ğŸ¶")
subject.onNext("ğŸ±")

subject
  .subscribe { print("Subscription: 2 Event:", $0) }
  .disposed(by: disposeBag)

subject.onNext("ğŸ…°ï¸")
subject.onNext("ğŸ…±ï¸")
å¤åˆ¶ä»£ç 
ç»“æœ
Subscription: 1 Event: next(ğŸ¶)
Subscription: 1 Event: next(ğŸ±)
Subscription: 1 Event: next(ğŸ…°ï¸)
Subscription: 2 Event: next(ğŸ…°ï¸)
Subscription: 1 Event: next(ğŸ…±ï¸)
Subscription: 2 Event: next(ğŸ…±ï¸)
å¤åˆ¶ä»£ç 

ReplaySubjectå°†å¯¹è§‚å¯Ÿè€…å‘é€å…¨éƒ¨çš„å…ƒç´ ï¼Œæ— è®ºè§‚å¯Ÿè€…æ˜¯ä½•æ—¶è¿›è¡Œè®¢é˜…çš„ã€‚

è¿™é‡Œå­˜åœ¨å¤šä¸ªç‰ˆæœ¬çš„ ReplaySubjectï¼Œæœ‰çš„åªä¼šå°†æœ€æ–°çš„ n ä¸ªå…ƒç´ å‘é€ç»™è§‚å¯Ÿè€…ï¼Œæœ‰çš„åªä¼šå°†é™åˆ¶æ—¶é—´æ®µå†…æœ€æ–°çš„å…ƒç´ å‘é€ç»™è§‚å¯Ÿè€…ã€‚
å¦‚æœæŠŠ ReplaySubject å½“ä½œè§‚å¯Ÿè€…æ¥ä½¿ç”¨ï¼Œæ³¨æ„ä¸è¦åœ¨å¤šä¸ªçº¿ç¨‹è°ƒç”¨ onNext, onError æˆ– onCompletedã€‚è¿™æ ·ä¼šå¯¼è‡´æ— åºè°ƒç”¨ï¼Œå°†é€ æˆæ„æƒ³ä¸åˆ°çš„ç»“æœã€‚
let disposeBag = DisposeBag()
let subject = ReplaySubject<String>.create(bufferSize: 1)//è®¢é˜…å‰çš„ç¼“å­˜ä¸ªæ•°

subject
  .subscribe { print("Subscription: 1 Event:", $0) }
  .disposed(by: disposeBag)

subject.onNext("ğŸ¶")
subject.onNext("ğŸ±")

subject
  .subscribe { print("Subscription: 2 Event:", $0) }
  .disposed(by: disposeBag)

subject.onNext("ğŸ…°ï¸")
subject.onNext("ğŸ…±ï¸")
å¤åˆ¶ä»£ç 
ç»“æœ
Subscription: 1 Event: next(ğŸ¶)
Subscription: 1 Event: next(ğŸ±)
Subscription: 2 Event: next(ğŸ±)
Subscription: 1 Event: next(ğŸ…°ï¸)
Subscription: 2 Event: next(ğŸ…°ï¸)
Subscription: 1 Event: next(ğŸ…±ï¸)
Subscription: 2 Event: next(ğŸ…±ï¸)
å¤åˆ¶ä»£ç 

BehaviorSubject å½“è§‚å¯Ÿè€…å¯¹ BehaviorSubject è¿›è¡Œè®¢é˜…æ—¶ï¼Œå®ƒä¼šå°†æº Observable ä¸­æœ€æ–°çš„å…ƒç´ å‘é€å‡ºæ¥ï¼ˆå¦‚æœä¸å­˜åœ¨æœ€æ–°çš„å…ƒç´ ï¼Œå°±å‘å‡ºé»˜è®¤å…ƒç´ ï¼‰ã€‚ç„¶åå°†éšåäº§ç”Ÿçš„å…ƒç´ å‘é€å‡ºæ¥.  ï¼ˆè®¢é˜…å‰çš„æœ€æ–°å…ƒç´ å‘å‡ºæ¥ï¼‰

let disposeBag = DisposeBag()
let subject = BehaviorSubject(value: "ğŸ”´")

subject
  .subscribe { print("Subscription: 1 Event:", $0) }
  .disposed(by: disposeBag)

subject.onNext("ğŸ¶")
subject.onNext("ğŸ±")

subject
  .subscribe { print("Subscription: 2 Event:", $0) }
  .disposed(by: disposeBag)

subject.onNext("ğŸ…°ï¸")
subject.onNext("ğŸ…±ï¸")

subject
  .subscribe { print("Subscription: 3 Event:", $0) }
  .disposed(by: disposeBag)

subject.onNext("ğŸ")
subject.onNext("ğŸŠ")
å¤åˆ¶ä»£ç 
ç»“æœ
Subscription: 1 Event: next(ğŸ”´)
Subscription: 1 Event: next(ğŸ¶)
Subscription: 1 Event: next(ğŸ±)
Subscription: 2 Event: next(ğŸ±)
Subscription: 1 Event: next(ğŸ…°ï¸)
Subscription: 2 Event: next(ğŸ…°ï¸)
Subscription: 1 Event: next(ğŸ…±ï¸)
Subscription: 2 Event: next(ğŸ…±ï¸)
Subscription: 3 Event: next(ğŸ…±ï¸)
Subscription: 1 Event: next(ğŸ)
Subscription: 2 Event: next(ğŸ)
Subscription: 3 Event: next(ğŸ)
Subscription: 1 Event: next(ğŸŠ)
Subscription: 2 Event: next(ğŸŠ)
Subscription: 3 Event: next(ğŸŠ)
å¤åˆ¶ä»£ç 

ControlProperty ä¸“é—¨ç”¨äºæè¿° UI æ§ä»¶å±æ€§çš„ï¼Œå®ƒå…·æœ‰ä»¥ä¸‹ç‰¹å¾ï¼š


















ä¸ä¼šäº§ç”Ÿ error äº‹ä»¶ä¸€å®šåœ¨ MainScheduler è®¢é˜…ï¼ˆä¸»çº¿ç¨‹è®¢é˜…ä¸€å®šåœ¨ MainScheduler ç›‘å¬ï¼ˆä¸»çº¿ç¨‹ç›‘å¬ï¼‰å…±äº«é™„åŠ ä½œç”¨
9ï¼ŒRxSwift è®¤ä¸ºä¸ç®¡æ˜¯ Cold è¿˜æ˜¯ Hotï¼Œå®ƒä»¬éƒ½æ˜¯ Observableï¼Œå®ƒä»¬åŒå±äºä¸€ä¸ªæŠ½è±¡ï¼Œè€Œä¸æ˜¯ä¸¤ç§ç‹¬ç«‹çš„ç±»å‹ã€‚è¿™ä¸ªè§‚ç‚¹å¾ˆæœ‰æ„æ€ï¼Œä¹Ÿå°±æ˜¯è¯´å¦‚æœä½ è‡ªå·±å£°æ˜äº†ä¸€ä¸ª Observableï¼ˆéµå®ˆ ObservableType åè®®ï¼‰ï¼Œä½¿ç”¨è€…å¹¶ä¸çŸ¥é“å®ƒæ˜¯ Cold è¿˜æ˜¯ Hotï¼Œåªæœ‰ä½ è‡ªå·±æ¸…æ¥šï¼ŒçœŸæ­£çš„â€œå†·æš–è‡ªçŸ¥â€ã€‚
Cold Observableåªæœ‰åœ¨è¢«è®¢é˜…çš„æ—¶å€™æ‰ä¼šå‘å°„äº‹ä»¶ï¼Œæ¯æ¬¡æœ‰æ–°çš„è®¢é˜…è€…éƒ½ä¼šæŠŠä¹‹å‰æ‰€æœ‰çš„äº‹ä»¶éƒ½é‡æ–°å‘å°„ä¸€éï¼› Hot Observableåˆ™æ˜¯å®æ—¶çš„ï¼Œä¸€æ—¦æœ‰æ–°çš„äº‹ä»¶å®ƒå°±å‘å°„ï¼Œä¸ç®¡æœ‰æ²¡æœ‰è¢«è®¢é˜…ï¼Œè€Œæ–°çš„è®¢é˜…è€…å¹¶ä¸ä¼šæ¥æ”¶åˆ°è®¢é˜…å‰å·²ç»å‘å°„è¿‡çš„äº‹ä»¶ã€‚

