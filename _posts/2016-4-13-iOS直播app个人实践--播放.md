---
layout: post
title: iOSç›´æ’­appä¸ªäººå®è·µ--æ’­æ”¾
date: 2016-4-13 15:32:24.000000000 +09:00
tags: [LiveVideo , Video , Auido , TransferProtocol]
---

å¦‚æœä¸äº†è§£åŸç†ï¼Œå¯ä»¥çœ‹è¿™ç¯‡æ–‡ç« [iOSç›´æ’­appä¸ªäººå®è·µ--åŸç†](http://garfieldlover.github.io/2015/12/iOS%E7%9B%B4%E6%92%ADapp%E4%B8%AA%E4%BA%BA%E5%AE%9E%E8%B7%B5-%E5%8E%9F%E7%90%86%E7%AF%87)ã€‚

ç”¨Bç«™å¼€æºçš„ijkplayeråšæ’­æ”¾å™¨ã€‚ç›´æ’­appä¸­ï¼Œéœ€è¦ç”¨åˆ°çš„ä¸€ä¸ªå¾ˆé‡è¦çš„å¼€æºæ¡†æ¶ijkplayerï¼Œé›†æˆè¿™ä¸ªæ¡†æ¶æ˜¯æ¯”è¾ƒæœ‰éš¾åº¦çš„ã€‚

## ä¸€ã€ç¼–è¯‘ijkPlayer
#### 1.1ã€ä¸‹è½½ijkPlayer
å»åˆ°Bç«™å¾—githubä¸»é¡µï¼Œæ‰¾åˆ°[ijkplayer](https://github.com/Bilibili/ijkplayer)é¡¹ç›®ï¼Œä¸‹è½½æºç .

#### 1.2ã€ç¼–è¯‘ijkPlayer
##### 1.2.1ã€è¿è¡ŒijkPlayerMediaDemo
- æç¤º'libavformat/avformat.h' file not found
- åŸå› ï¼šå› ä¸ºlibavformatæ˜¯ffmpegä¸­çš„åº“ï¼Œè€Œijkplayeræ˜¯åŸºäºffmpegè¿™ä¸ªåº“çš„ï¼Œå› æ­¤éœ€è¦å¯¼å…¥ffmpeg
- è§£å†³ï¼šæŸ¥çœ‹ijkplayerçš„README.mdï¼Œä¸€èˆ¬éƒ½ä¼šæœ‰è¯´æ˜ã€‚

![ijkPlayer](https://raw.githubusercontent.com/GarfieldLover/GarfieldLover.github.io/master/assets/postImages/304825-cca008e8e9f490e2.png)

- æ­¥éª¤ä¸€ï¼šæ‰¾åˆ°init-ios.shè„šæœ¬æ–‡ä»¶
- æ­¥éª¤äºŒï¼šæ‰“å¼€ç»ˆç«¯ï¼Œcdè¿›å…¥åˆ°ijkplayer-masterçš„ç›®å½•ä¸­
- æ­¥éª¤ä¸‰ï¼šè¾“å…¥./init-ios.shï¼Œå°±ä¼šæ‰§è¡Œå½“å‰è„šæœ¬äº†ã€‚
- æ‰§è¡Œå®Œè„šæœ¬åï¼Œå°±ä¼šå‘ç°ijkplayerä¸­æœ‰ffmpegäº†

##### 1.2.2ã€ä¸‹è½½å¥½ffmpegæºç åï¼Œå†æ¬¡è¿è¡ŒDemo
- å‘ç°è¿˜æ˜¯æŠ¥'libavformat/avformat.h' file not foundé”™è¯¯
- åŸå› :æ‰§è¡Œinit-ios.shï¼Œä»…ä»…æ˜¯ä¸‹è½½æºç ï¼Œä½†æ˜¯æºç å¹¶æ²¡æœ‰å‚ä¸ç¼–è¯‘ï¼Œéœ€è¦æŠŠæºç ç¼–è¯‘æˆ.aæ–‡ä»¶
- è§£å†³:æŸ¥çœ‹ijkplayerçš„README.md
![nginx](https://raw.githubusercontent.com/GarfieldLover/GarfieldLover.github.io/master/assets/postImages/304825-be6a86d42b1b2b85.png)

ç¼–è¯‘ffmpegåº“
- æ­¥éª¤ä¸€ï¼šè¿›å…¥åˆ°è„šæœ¬æ–‡ä»¶çš„ç›®å½•ä¸‹
- æ­¥éª¤äºŒï¼šæ‰§è¡Œ./compile-ffmpeg.sh clean
- æ­¥éª¤äºŒåŠŸèƒ½ï¼šåˆ é™¤ä¸€äº›æ–‡ä»¶å’Œæ–‡ä»¶å¤¹ï¼Œä¸ºç¼–è¯‘ffmpeg.shåšå‡†å¤‡ï¼Œåœ¨ç¼–è¯‘ffmpeg.shçš„æ—¶å€™ï¼Œä¼šè‡ªåŠ¨åˆ›å»ºåˆšåˆšåˆ é™¤çš„é‚£äº›æ–‡ä»¶ï¼Œä¸ºé¿å…æ–‡ä»¶åå†²çªï¼Œå› æ­¤åœ¨ç¼–è¯‘ffmpeg.shä¹‹å‰å…ˆåˆ é™¤ç­‰ä¼šä¼šè‡ªåŠ¨åˆ›å»ºçš„æ–‡ä»¶å¤¹æˆ–è€…æ–‡ä»¶
- æ­¥éª¤ä¸‰ï¼šæ‰§è¡Œ./compile-ffmpeg.sh all,çœŸæ­£çš„ç¼–è¯‘å„ä¸ªå¹³å°çš„ffmpegåº“ï¼Œå¹¶ç”Ÿæˆæ‰€ä»¥å¹³å°çš„é€šç”¨åº“.

æ‰§è¡Œcompile-ffmpeg.sh allå
![nginx](https://raw.githubusercontent.com/GarfieldLover/GarfieldLover.github.io/master/assets/postImages/304825-550c2ed42b16519c.png)

##### 1.2.3ã€å†æ¬¡è¿è¡ŒDemo
ç¼–è¯‘å®Œffmpegåï¼ŒIJKMediaPlayeråº“ä¸­æ˜¾ç¤º
![nginx](https://raw.githubusercontent.com/GarfieldLover/GarfieldLover.github.io/master/assets/postImages/304825-b464482cec192c00.png)

## äºŒã€é›†æˆijkplayer
#### 2.1ã€æŠŠIJKMediaPlayeræ‰“åŒ…æˆé™æ€åº“
å¦‚ä½•æ‰“åŒ…ï¼Œè¯·å‚è€ƒï¼Œ[iOSä¸­é›†æˆijkplayerè§†é¢‘ç›´æ’­æ¡†æ¶](http://www.jianshu.com/p/1f06b27b3ac0)ï¼Œå†™çš„éå¸¸ä¸é”™ï¼Œå°±ä¸ä¸€ä¸€è¯¦ç»†ä»‹ç»äº†,ä½†æ˜¯åªæœ‰å‘å¸ƒç‰ˆæœ¬çš„åº“ã€‚

ç›´æ¥æŠŠijkplayeråº“æ‹–å…¥åˆ°è‡ªå·±çš„å·¥ç¨‹ä¸­ï¼Œ
è°ƒè¯•çš„è¯ï¼Œæ‹–å…¥è°ƒè¯•ç‰ˆæœ¬çš„ijkplayeråº“ï¼Œå‘å¸ƒçš„è¯ï¼Œæ‹–å…¥å‘å¸ƒç‰ˆæœ¬çš„ijkplayeråº“

å¯¼å…¥ijkplayerä¾èµ–çš„åº“ï¼Œå…·ä½“å¯ä»¥æŸ¥çœ‹ijkplayerçš„README
![nginx](https://raw.githubusercontent.com/GarfieldLover/GarfieldLover.github.io/master/assets/postImages/304825-2d968c96c6d49e14.png)

è¿™é‡Œæœ‰ä¸ªæ‰“åŒ…å¥½çš„[gitåœ°å€](https://git.coding.net/shirokuma/IJKMediaLibrary.git)ã€‚

## ä¸‰ã€ä½¿ç”¨ijkplayerç›´æ’­
#### 3.1ã€ijkplayerç”¨æ³•ç®€ä»‹
ijkplayerç”¨æ³•æ¯”è¾ƒç®€å•ï¼Œå…¶å®åªè¦æœ‰ç›´æ’­åœ°å€ï¼Œå°±èƒ½ç›´æ’­äº†
#### 3.2ã€æ’­æ”¾è°ƒç”¨

```
- (void)viewDidLoad {
    [super viewDidLoad];

    self.view.backgroundColor = [UIColor whiteColor];

    // è®¾ç½®ç›´æ’­å ä½å›¾ç‰‡
    NSURL *imageUrl = [NSURL URLWithString:[NSString stringWithFormat:@"http://img.meelive.cn/%@",_live.creator.portrait]];
    [self.imageView sd_setImageWithURL:imageUrl placeholderImage:nil];

    // æ‹‰æµåœ°å€
    NSURL *url = [NSURL URLWithString:_live.stream_addr];

    // åˆ›å»ºIJKFFMoviePlayerControllerï¼šä¸“é—¨ç”¨æ¥ç›´æ’­ï¼Œä¼ å…¥æ‹‰æµåœ°å€å°±å¥½äº†
    IJKFFMoviePlayerController *playerVc = [[IJKFFMoviePlayerController alloc] initWithContentURL:url withOptions:nil];

    // å‡†å¤‡æ’­æ”¾
    [playerVc prepareToPlay];

    // å¼ºå¼•ç”¨ï¼Œåæ­£è¢«é”€æ¯
    _player = playerVc;

    playerVc.view.frame = [UIScreen mainScreen].bounds;

    [self.view insertSubview:playerVc.view atIndex:1];

}
```
#### 3.3ã€æ’­æ”¾ç»“æŸ
ç•Œé¢ä¸æ’­æ”¾ï¼Œä¸€å®šè¦è®°å¾—ç»“æŸæ’­æ”¾ï¼Œå¦åˆ™ä¼šæŠ¥å†…å­˜æº¢å‡º

```
- (void)viewWillDisappear:(BOOL)animated
{
    [super viewWillDisappear:animated];

    // ç•Œé¢æ¶ˆå¤±ï¼Œä¸€å®šè¦è®°å¾—åœæ­¢æ’­æ”¾
    [_player pause];
    [_player stop];
}
```

[ä»£ç è¯¦ç»†è¯·çœ‹è¿™é‡Œ](https://github.com/GarfieldLover/GLLoveLiveVideo)ã€‚

## å››ã€ijkplayeræ‹‰æµæ’­æ”¾è¯¦è§£ï¼ˆé‡ç‚¹ğŸ˜„ğŸ˜„ï¼‰
ijkplayeræä¾›çš„æ’­æ”¾ç±»å¦‚ä¸‹ã€‚

æ’­æ”¾ç±» | IJKMPMoviePlayerController | IJKAVMoviePlayerController | IJKFFMoviePlayerController
---|---|---|---
è§£ç å™¨ |MPMoviePlayerController | AVPlayer | ffmpeg
è§£ç |ç¡¬è§£ | ç¡¬è§£ | è½¯è§£ï¼ˆvideotoolboxç¡¬è§£ï¼‰
ç»˜åˆ¶| |  | OpenGLES2


#### 4.1ã€ijkplayeræ’­æ”¾æµç¨‹
![æ¨æµ](https://raw.githubusercontent.com/GarfieldLover/GarfieldLover.github.io/master/assets/postImages/ijkæµç¨‹.png)

#### 4.2ã€ijkplayerä¸‹è½½

#### 4.3ã€ijkplayerè¯»å–æ•°æ®
![æ¨æµ](https://raw.githubusercontent.com/GarfieldLover/GarfieldLover.github.io/master/assets/postImages/ijkè¯»å–.png)

#### 4.4ã€ijkplayerç»˜åˆ¶
![æ¨æµ](https://raw.githubusercontent.com/GarfieldLover/GarfieldLover.github.io/master/assets/postImages/ijkç»˜åˆ¶.png)

#### 4.5ã€ijkplayerå£°éŸ³
![æ¨æµ](https://raw.githubusercontent.com/GarfieldLover/GarfieldLover.github.io/master/assets/postImages/ijkå£°éŸ³.png)


```
å¦‚ä½•å¼ºåˆ¶æ‰“å¼€ç¡¬è§£
[options setPlayerOptionIntValue:1 forKey:@"videotoolbox"];
```

```
openglå¦‚ä½•ç»˜åˆ¶
glDrawArrays(GL_TRIANGLE_STRIP, 0, 4);      
```

```
æ’­æ”¾éŸ³é¢‘
OSStatus status = AudioQueueStart(_audioQueueRef, NULL);
```
## äº”ã€æ’­æ”¾äº’åŠ¨å®ç°
ğŸ·

## å…­ã€é‡‘å±±äº‘ç›´æ’­æ–¹æ¡ˆ
[é‡‘å±±äº‘ä»£ç ](https://github.com/ksvc/KSYLive_iOS)

```
é‡‘å±±äº‘éœ€è¦å’Œå•†åŠ¡ä»£è¡¨è”ç³»æ‰èƒ½å¼€é€šè¯•ç”¨ã€‚
```

æ¨æµè®¾ç½® | ç¾é¢œç­‰é‡‡é›†è®¾ç½® | æ’­æ”¾è®¾ç½®
---|---|---
![æ¨æµ](https://raw.githubusercontent.com/GarfieldLover/GarfieldLover.github.io/master/assets/postImages/Snip20161229_2.png)| ![ç¾é¢œ](https://raw.githubusercontent.com/GarfieldLover/GarfieldLover.github.io/master/assets/postImages/Snip20161229_3.png)|![æ’­æ”¾](https://raw.githubusercontent.com/GarfieldLover/GarfieldLover.github.io/master/assets/postImages/Snip20161229_4.png)
