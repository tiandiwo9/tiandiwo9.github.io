---
layout: post
title: iOSç›´æ’­appä¸ªäººå®è·µ--æ¨æµç¯‡
date: 2015-12-31 15:32:24.000000000 +09:00
tags: [LiveVideo , Video , Auido , TransferProtocol]
---

å¦‚æœä¸äº†è§£åŸç†ï¼Œå¯ä»¥çœ‹è¿™ç¯‡æ–‡ç« [iOSç›´æ’­appä¸ªäººå®è·µ--åŸç†ç¯‡](http://garfieldlover.github.io/2015/12/iOS%E7%9B%B4%E6%92%ADapp%E4%B8%AA%E4%BA%BA%E5%AE%9E%E8%B7%B5-%E5%8E%9F%E7%90%86%E7%AF%87)ã€‚

å¼€å‘ä¸€æ¬¾ç›´æ’­appï¼Œéœ€è¦æµåª’ä½“æœåŠ¡å™¨ï¼Œæœ¬ç¯‡ä¸»è¦è®²è§£ç›´æ’­ä¸­æµåª’ä½“æœåŠ¡å™¨æ­å»ºï¼Œä¸‹è¾¹ä»‹ç»å¸¸ç”¨åŠŸèƒ½ã€‚

## ä¸€ã€nginx
nginxæ˜¯éå¸¸ä¼˜ç§€çš„HTTPå¼€æºæœåŠ¡å™¨ï¼Œå…¶ç‰¹ç‚¹æ˜¯å æœ‰å†…å­˜å°‘ï¼Œå¹¶å‘èƒ½åŠ›å¼ºï¼Œç”¨å®ƒæ¥åšhlsæˆ–è€…rtmpæµåª’ä½“æœåŠ¡å™¨æ˜¯éå¸¸ä¸é”™çš„é€‰æ‹©ã€‚
#### 1.1ã€å®‰è£…Homebrow
æŸ¥çœ‹æ˜¯å¦å·²ç»å®‰è£…

```
man brew
```
æ‰§è¡Œå®‰è£…å‘½ä»¤

```
ruby -e "$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/master/install)"
```
å¸è½½
```
ruby -e "$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/master/uninstall)"
```
#### 1.2ã€å®‰è£…nginx
å…ˆclone nginxé¡¹ç›®åˆ°æœ¬åœ°ï¼š

```
brew tap homebrew/nginx
```
æ‰§è¡Œå®‰è£…ï¼š

```
brew install nginx-full --with-rtmp-module
```
nginxå®‰è£…ä½ç½®

```
brew info nginx-full
```
nginxå®‰è£…æ‰€åœ¨ä½ç½®

```
/usr/local/Cellar/nginx-full/1.10.1/bin/nginx
```
nginxé…ç½®æ–‡ä»¶æ‰€åœ¨ä½ç½®

```
/usr/local/etc/nginx/nginx.conf
```
#### 1.3ã€è¿è¡Œnginx
æ‰§è¡Œå‘½ä»¤ ï¼Œæµ‹è¯•ä¸‹æ˜¯å¦èƒ½æˆåŠŸå¯åŠ¨nginxæœåŠ¡

```
nginx
```

åœ¨æµè§ˆå™¨åœ°å€æ è¾“å…¥ï¼š[http://localhost:8080](http://localhost:8080)
å¦‚æœå‡ºç°,ä»£è¡¨nginxå®‰è£…æˆåŠŸäº†

![nginx](https://raw.githubusercontent.com/GarfieldLover/GarfieldLover.github.io/master/assets/postImages/2004362-ca10e04901ad2b45.png)


å¦‚æœç»ˆç«¯ä¸Šæç¤º,åˆ™è¡¨ç¤º8080ç«¯å£è¢«å ç”¨äº†

```
nginx: [emerg] bind() to 0.0.0.0:8080 failed (48: Address already in use)
```
æŸ¥çœ‹8080ç«¯å£PID

```
lsof -i tcp:8080
```
killæ‰å ç”¨8080ç«¯å£çš„PID,ç„¶åé‡æ–°æ‰§è¡Œnginx

```
kill 9603ï¼ˆè¿™é‡Œæ›¿æ¢æˆå ç”¨8080ç«¯å£çš„PIDï¼‰
```
é‡æ–°åŠ è½½é…ç½®æ–‡ä»¶

```
nginx -s reload
```

åœæ­¢ nginx

```
nginx -s stop
```

æœ‰åºé€€å‡º nginx

```
nginx -s quit
```
#### 1.4ã€é…ç½®rtmp
ç°åœ¨æˆ‘ä»¬æ¥ä¿®æ”¹nginx.confè¿™ä¸ªé…ç½®æ–‡ä»¶ï¼Œé…ç½®rtmpã€‚æ‰“å¼€Finder Shift + command + Gå‰å¾€ï¼Œç”¨è®°äº‹æœ¬å·¥å…·æ‰“å¼€nginx.confã€‚

åœ¨httpèŠ‚ç‚¹åé¢åŠ ä¸Šrtmpé…ç½®ã€‚

```
rtmp {

  server {
      listen 1935;

    #ç›´æ’­æµé…ç½®
      application rtmplive {
          live on;
      #ä¸º rtmp å¼•æ“è®¾ç½®æœ€å¤§è¿æ¥æ•°ã€‚é»˜è®¤ä¸º off
      max_connections 1024;

       }

      application hls{

          live on;
          hls on;
          hls_path /usr/local/var/www/hls;
          hls_fragment 1s;
      }
   }
}
```
#### 1.5ã€æ¨æµåŠè§‚çœ‹
æ¨æµåœ°å€ï¼Œæœ¬æœºip

```
rtmp://10.2.130.88/rtmplive/livestream
```
##### 1.5.1ã€å®‰è£…ffmepgè¿›è¡Œæ¨æµï¼ˆæœªå®é™…æ“ä½œğŸ˜„)

```
brew install ffmpeg
```
æŠ“å–æ¡Œé¢å’Œæ‘„åƒå¤´è¿›è¡Œæ¨æµ

```
ffmpeg -f avfoundation -framerate 30 -i "1:0" -f avfoundation -framerate 30 -video_size 640x480 -i "0" -c:v libx264 -preset slow -filter_complex 'overlay=main_w-overlay_w-10:main_h-overlay_h-10' -acodec libmp3lame -ar 44100 -ac 1  -f flv rtmp://10.2.130.88/rtmplive/livestream
```

##### 1.5.2ã€LFLiveKitè¿›è¡Œæ¨æµ
è¯¦æƒ…è§[githubä»£ç ](https://github.com/GarfieldLover/GLLoveLiveVideo)ã€‚

##### 1.5.3ã€Macæ’­æ”¾
å®‰è£…[VLC](http://www.videolan.org/)å¼€æºæ’­æ”¾å™¨æµ‹è¯•æ¨æµæ•°æ®ã€‚

#### 1.5ã€nginxè½¬ç å°è£…é—®é¢˜
åªå®ç°äº†æ¨æµï¼Œhlsæ’­æ”¾æµå’Œflvæ’­æ”¾æµæ²¡æœ‰æµ‹è¯•æˆåŠŸï¼Œ***å¾ˆå¯èƒ½æ˜¯æˆ‘çš„é…ç½®é—®é¢˜***ã€‚ åæ¥ä½¿ç”¨äº†å›½äººå¼€æºçš„SRSæœåŠ¡å™¨æ–¹æ¡ˆå¾—åˆ°å¾ˆå¥½è§£å†³ã€‚


## äºŒã€SRS
SRSå®šä½æ˜¯è¿è¥çº§çš„äº’è”ç½‘ç›´æ’­æœåŠ¡å™¨é›†ç¾¤ï¼ŒSRSæä¾›äº†ä¸°å¯Œçš„æ¥å…¥æ–¹æ¡ˆå°†RTMPæµæ¥å…¥SRSã€‚è¿˜æ”¯æŒå°†æ¥å…¥çš„RTMPæµè¿›è¡Œå„ç§å˜æ¢ï¼Œè­¬å¦‚å°†RTMPæµè½¬ç ã€è½¬å‘ç»™å…¶ä»–æœåŠ¡å™¨ã€è½¬å°è£…æˆHTTP-FLVæµã€è½¬å°è£…æˆHLSã€è½¬å°è£…æˆHDSã€å½•åˆ¶æˆFLVã€‚

#### 2.1ã€è·å–SRS